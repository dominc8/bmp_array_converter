#include "CUnit/CUnitCI.h"
#include "parser_bh.h"
#include "test_parser_bh.h"


void parser_bh_nullptr(void)
{
    bh_data_t bh_data;
    uint8_t mem[BH_SIZE];
    CU_ASSERT_EQUAL(bh_parse(NULL, NULL), BH_NULLPTR);
    CU_ASSERT_EQUAL(bh_parse(&bh_data, NULL), BH_NULLPTR);
    CU_ASSERT_EQUAL(bh_parse(NULL, &mem[0]), BH_NULLPTR);
}

void parser_bh_ret(void)
{
    bh_data_t bh_data;
    uint8_t proper_bh_mem[BH_SIZE] = 
    {
        0x28, 0x00, 0x00, 0x00,
        0x1d, 0x00, 0x00, 0x00,
        0x2e, 0x00, 0x00, 0x00,
        0x01, 0x00,
        0x20, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0xda, 0x14, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
    };
    int32_t ret_val =  bh_parse(&bh_data, &proper_bh_mem[0]);
    CU_ASSERT_EQUAL(ret_val, BH_OK);
}

void parser_bh_wrong_header_size(void)
{
    bh_data_t bh_data;
    uint8_t bh_mem[BH_SIZE] = 
    {
        0x29, 0x00, 0x00, 0x00,
        0x1d, 0x00, 0x00, 0x00,
        0x2e, 0x00, 0x00, 0x00,
        0x01, 0x00,
        0x20, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0xda, 0x14, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
    };
    int32_t ret_val =  bh_parse(&bh_data, &bh_mem[0]);
    CU_ASSERT_EQUAL(ret_val, BH_HSIZE_ERR);
}

void parser_bh_wrong_n_color_planes(void)
{
    bh_data_t bh_data;
    uint8_t bh_mem[BH_SIZE] = 
    {
        0x28, 0x00, 0x00, 0x00,
        0x1d, 0x00, 0x00, 0x00,
        0x2e, 0x00, 0x00, 0x00,
        0x00, 0x00,
        0x20, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0xda, 0x14, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
    };
    int32_t ret_val =  bh_parse(&bh_data, &bh_mem[0]);
    CU_ASSERT_EQUAL(ret_val, BH_NCP_ERR);
}

void parser_bh_data(void)
{
    bh_data_t bh_data;
    uint8_t proper_bh_mem[BH_SIZE] = 
    {
        0x28, 0x00, 0x00, 0x00,
        0x1d, 0x00, 0x00, 0x00,
        0x2e, 0x00, 0x00, 0x00,
        0x01, 0x00,
        0x20, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0xda, 0x14, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x11, 0x17, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00,
    };
    int32_t ret_val =  bh_parse(&bh_data, &proper_bh_mem[0]);
    CU_ASSERT_EQUAL(ret_val, BH_OK);
    CU_ASSERT_EQUAL(bh_data.header_size, (uint16_t)0x00000028);
    CU_ASSERT_EQUAL(bh_data.img_width, (int32_t)0x0000001D);
    CU_ASSERT_EQUAL(bh_data.img_height, (int32_t)0x0000002E);
    CU_ASSERT_EQUAL(bh_data.n_color_planes, (uint16_t)0x0001);
    CU_ASSERT_EQUAL(bh_data.n_bits_per_pixel, (uint16_t)0x0020);
    CU_ASSERT_EQUAL(bh_data.compression, (uint32_t)0x00000000);
    CU_ASSERT_EQUAL(bh_data.bitmap_size, (uint32_t)0x000014DA);
    CU_ASSERT_EQUAL(bh_data.ppm_hor, (uint32_t)0x00001711);
    CU_ASSERT_EQUAL(bh_data.ppm_ver, (uint32_t)0x00001711);
    CU_ASSERT_EQUAL(bh_data.n_colors_in_palette, (uint32_t)0x00000000);
    CU_ASSERT_EQUAL(bh_data.n_important_colors, (uint32_t)0x00000000);
}


